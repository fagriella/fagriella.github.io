<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F.AGRIELLA</title>
    <link rel="icon" href="images/logo/F.AGRIELLA.webp" type="image/webp">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icon Library (Phosphor Icons) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- OneSignal SDK -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
        window.OneSignalDeferred = window.OneSignalDeferred || [];
        OneSignalDeferred.push(async function (OneSignal) {
            await OneSignal.init({
                appId: "8d435ddc-5a2b-4a91-83c4-3c10d0ed5fc6",
            });
        });
    </script>
    <link rel="stylesheet" href="style.css">
    <script>
        // Mencegah "flash" dengan menerapkan preferensi dari localStorage sebelum render
        (function () {
            // Hanya terapkan jika persetujuan untuk personalisasi telah diberikan
            if (localStorage.getItem('consent_personalization') === 'true') {
                if (localStorage.getItem('theme') === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }
            }
        })();
    </script>
</head>

<body>

    <!-- Main Menu (Sliding from left) -->
    <div id="main-menu" class="main-menu">
        <div class="main-menu-header">
            <a href="#" class="logo">
                <span class="accent">F.</span>AGRIELLA
            </a>
            <button id="close-main-menu" class="icon-btn" style="font-size: 2rem; color: var(--white);">&times;</button>
        </div>
        <ul class="main-menu-links">
            <li><a href="#" id="menu-beranda"><i class="ph ph-house"></i> Beranda</a></li>
            <li><a href="#arsipfoto" id="menu-arsip-foto"><i class="ph ph-images"></i> Arsip Foto</a></li>
            <li><a href="#undi" id="menu-undi"><i class="ph ph-dice-five"></i> Undi Kelompok</a></li>
            <li><a href="#upload" id="menu-upload" style="display: none;"><i class="ph ph-upload-simple"></i> Upload
                    Materi</a></li>
            <li><a href="#pengaturan" id="menu-pengaturan"><i class="ph ph-gear"></i> Pengaturan</a></li>
        </ul>
    </div>
    <div id="menu-overlay" class="menu-overlay"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Memuat data...</p>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <div class="nav-left">
                <button id="menu-toggle" class="icon-btn" aria-label="Menu">
                    <i class="ph ph-list"></i>
                </button>
                <a href="#" class="logo">
                    <span class="accent">F.</span>AGRIELLA
                </a>
            </div>
            <div class="nav-controls">
                <div class="search-bar">
                    <i class="ph ph-magnifying-glass"></i>
                    <input type="text" id="global-search" placeholder="Cari materi, dosen, atau tugas...">
                </div>
                <div id="navbar-undi-settings" class="undi-settings-wrapper" style="display: none;">
                    <button id="undi-settings-btn" class="icon-btn" aria-label="Pengaturan Undian">
                        <i class="ph ph-gear"></i>
                    </button>
                    <div id="undi-settings-panel" class="undi-settings-panel">
                        <div class="control-item" title="Lama Putaran (Detik)">
                            <i class="ph ph-timer" style="font-size: 1.2rem; color: var(--text-secondary);"></i>
                            <input type="number" id="spin-duration-input" min="1" max="60" value="3">
                            <span style="color: var(--text-secondary); font-size: 0.9rem;">Detik</span>
                        </div>
                        <div class="control-item">
                            <label for="skip-animation-toggle" style="font-size: 0.85rem; color: var(--text-secondary); cursor: pointer;">Skip</label>
                            <label class="toggle-switch" style="transform: scale(0.8); margin: 0;">
                                <input type="checkbox" id="skip-animation-toggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <button id="notif-toggle" class="icon-btn" aria-label="Notifikasi">
                    <i class="ph ph-bell"></i>
                </button>
                <button id="theme-toggle" class="icon-btn" aria-label="Toggle Dark Mode">
                    <i class="ph ph-moon"></i>
                </button>
            </div>
        </div>
    </nav>


    <main class="container main-layout">

        <!-- Sidebar / Dashboard Ringkas -->
        <aside class="sidebar">
            <div class="dashboard-card">
                <h3>Dashboard</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-val" id="total-courses">0</span>
                        <span class="stat-label">Mata Kuliah</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-val" id="total-assignments">0</span>
                        <span class="stat-label">Tugas Aktif</span>
                    </div>
                </div>
            </div>

            <div class="assignment-section">
                <div class="section-title">
                    <h3><i class="ph ph-calendar"></i> Tugas Terbaru</h3>
                </div>
                <!-- List Tugas (Di-inject oleh JS berdasarkan nama file tanggal) -->
                <div id="assignment-list" class="assignment-list">
                    <div class="skeleton-loader"></div>
                </div>
            </div>

            <div class="quick-links">
                <h3>Bookmark</h3>
                <ul id="bookmark-list" style="list-style: none; padding-left: 0;">
                    <li class="empty-state">Belum ada bookmark</li>
                </ul>
            </div>
        </aside>

        <!-- Main Content: Daftar Mata Kuliah -->
        <section class="content-area">
            <div class="content-header">
                <h2>Daftar Mata Kuliah</h2>
                <div class="filters">
                    <select id="semester-filter">
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                        <option value="3">Semester 3</option>
                    </select>
                </div>
            </div>

            <!-- Grid Mata Kuliah (Sumber: Google Sheets Logic) -->
            <div id="course-grid" class="course-grid">
                <!-- Course Cards injected here -->
            </div>
        </section>

        <!-- Arsip Foto Content -->
        <section id="container-arsip-foto" class="content-area" style="display: none;">
            <div class="content-header">
                <h2>ðŸ“¸ Arsip Foto Dokumentasi</h2>
                <div class="filters">
                    <select id="arsip-semester-filter">
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                        <option value="3">Semester 3</option>
                    </select>
                </div>
            </div>

            <div class="album-grid" id="album-grid">
                <!-- Album cards injected here -->
            </div>
        </section>

        <!-- Undi Kelompok Content (Spin Wheel) -->
        <section id="container-undi" class="content-area" style="display: none;">
            <!-- Header untuk bagian ini telah dihapus dan kontennya dipindahkan ke navbar -->
            <div class="spin-card" style="padding: 1rem 0; text-align: center; box-sizing: border-box; width: 100%;">

                <div class="spin-controls"
                    style="display: flex; gap: 2rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap;">

                    <!-- Kiri: Textarea -->
                    <div id="spin-left-panel"
                        style="text-align: left; flex: 1; min-width: 250px; transition: all 0.5s ease; opacity: 1; transform: scale(1);">
                        <label for="spin-names-textarea"
                            style="display:flex; justify-content: space-between; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 1rem;">
                            <span>Daftar Nama (Baris Baru)</span>
                            <span id="spin-names-count" style="font-weight: bold; color: var(--brand-color);">0
                                Orang</span>
                        </label>
                        <textarea id="spin-names-textarea" rows="12"
                            style="width: 100%; padding: 1rem; border-radius: var(--radius); border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-primary); font-size: 1rem; outline: none; resize: vertical;"
                            placeholder="Memuat data..."></textarea>
                    </div>

                    <!-- Kanan: Input, Bola Spin, dan Tombol -->
                    <div id="spin-right-panel"
                        style="display: flex; flex-direction: column; align-items: center; gap: 1.5rem; min-width: 250px; padding-top: 0.5rem; transition: all 0.5s ease; flex: 1;">

                        <div id="spin-group-input-container"
                            style="text-align: center; width: 100%; transition: opacity 0.3s;">
                            <label for="spin-groups"
                                style="display:block; margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">Mau
                                Dibagi Berapa Kelompok?</label>
                            <input type="number" id="spin-groups" min="1" max="50" value="5"
                                style="padding: 0.75rem 1rem; border-radius: var(--radius); border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-primary); font-size: 1.2rem; font-weight: bold; outline: none; width: 100%; text-align: center;">
                        </div>

                        <!-- Bola Spin (Canvas) -->
                        <div class="spin-display" id="spin-display"
                            style="width: 200px; height: 200px; overflow: hidden; position: relative; background: var(--bg-color); border: 4px solid #d97706; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(217, 119, 6, 0.3); transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1); margin: 0 auto; z-index: 10;">
                            <!-- Panah Penunjuk -->
                            <div
                                style="position: absolute; top: -5px; left: 50%; transform: translateX(-50%); color: #1e3932; font-size: 2.5rem; z-index: 20; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                                <i class="ph-fill ph-caret-down"></i></div>
                            <canvas id="spin-canvas" width="400" height="400"
                                style="width: 100%; height: 100%; display: block;"></canvas>
                        </div>

                        <button id="btn-spin"
                            style="background: var(--brand-color); color: white; border: none; padding: 1rem 3rem; font-size: 1.2rem; font-weight: 600; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3); width: 100%;">
                            Mulai Acak!
                        </button>

                    </div>
                </div>

                <!-- Tempat Hasil Kelompok -->
                <div id="spin-results-wrapper"
                    style="position: relative; background: var(--bg-color); border-radius: var(--radius); transition: all 0.3s ease;">
                    <div id="results-header" class="fullscreen-header"
                        style="display: flex; justify-content: space-between; align-items: center; margin-top: 3rem; margin-bottom: 1rem; padding: 0 1rem; transition: background 0.3s;">
                        <h3 style="margin: 0;">Hasil Pembagian</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="btn-share-results" class="icon-btn"
                                style="background: #25D366; border: none; color: white; padding: 0.5rem; border-radius: var(--radius); display: none;" title="Bagikan ke WhatsApp">
                                <i class="ph ph-whatsapp-logo" style="font-size: 1.2rem;"></i>
                            </button>
                            <button id="btn-fullscreen-results" class="icon-btn"
                                style="background: var(--card-bg); border: 1px solid var(--border-color); color: var(--text-primary); padding: 0.5rem; border-radius: var(--radius); display: none;" title="Fullscreen">
                                <i class="ph ph-corners-out" style="font-size: 1.2rem;"></i>
                            </button>
                        </div>
                    </div>
                    <div id="spin-results">
                        <!-- Hasil diinject via JS -->
                    </div>
                </div>
        </section>

        <!-- iframe Upload -->
        <section id="container-upload" class="content-area" style="display: none; height: calc(100vh - 100px);">
            <iframe id="upload-iframe" src="about:blank" frameborder="0" width="100%" height="100%"
                style="border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);"></iframe>
        </section>

    </main>

    <!-- Modal Detail Materi -->
    <div id="material-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Detail Mata Kuliah</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modal-meta-container"></div>
                <div class="modal-tabs">
                    <button class="tab-btn active" data-tab="dokumen">Dokumen</button>
                    <button class="tab-btn" data-tab="foto">Foto</button>
                </div>
                <div class="file-list" id="modal-files">
                    <!-- File items injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detail Tugas (JSON Viewer) -->
    <div id="assignment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Detail Tugas Harian</h2>
                <button class="close-modal" id="close-assign-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div
                    style="margin-bottom: 1.5rem; color: var(--text-secondary); border-bottom:1px solid var(--border-color); padding-bottom:1rem;">
                    <i class="ph ph-calendar-check"></i> Tanggal Dibuat: <span id="assign-modal-date"
                        style="font-weight:600; color:var(--text-primary);"></span>
                </div>
                <div id="assign-modal-list">
                    <!-- List Tugas Injected Here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Preview File -->
    <div id="preview-modal" class="modal" style="z-index: 1100;">
        <div class="modal-content" style="height: 90vh; max-width: 90vw;">
            <div class="modal-header">
                <h2 id="preview-title"
                    style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80%;">Preview</h2>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button id="fullscreen-btn" class="close-modal" style="font-size: 1.5rem;" title="Fullscreen"><i
                            class="ph ph-corners-out"></i></button>
                    <button class="close-modal" id="close-preview-modal">&times;</button>
                </div>
            </div>
            <div class="modal-body"
                style="padding: 0; height: 100%; display: flex; flex-direction: column; overflow: hidden;">
                <iframe id="preview-frame" style="width: 100%; height: 100%; border: none;" src=""
                    allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <!-- Modal Pengaturan Cookie -->
    <div id="cookie-settings-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Pusat Privasi</h2>
                <button class="close-modal" id="close-cookie-settings-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Anda dapat mengontrol penyimpanan data
                    di browser Anda. Pilihan Anda akan disimpan untuk kunjungan berikutnya.</p>
                <div class="cookie-pref-item">
                    <h4>Penyimpanan Fungsional</h4>
                    <p>Selalu aktif. Diperlukan agar situs dapat berfungsi dengan benar.</p>
                </div>
                <div class="cookie-pref-item">
                    <h4>Preferensi & Personalisasi</h4>
                    <p>Izinkan situs menyimpan preferensi tampilan (seperti Tema Gelap) dan item yang Anda tandai
                        (Bookmark).</p>
                    <label class="toggle-switch">
                        <input type="checkbox" id="consent-personalization-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="cookie-pref-item">
                    <h4>Notifikasi</h4>
                    <p>Kelola izin notifikasi untuk tugas baru.</p>
                    <button id="btn-check-notif-settings" style="background: var(--stone-grey); border: 1px solid var(--border-color); color: var(--text-primary); padding: 0.5rem 1rem; border-radius: 50px; cursor: pointer; font-size: 0.85rem; margin-top: 0.5rem;">Cek Status</button>
                </div>

                <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 1.5rem 0;">

                <div class="cookie-pref-item">
                    <h4>Token Akses</h4>
                    <p>Masukkan kata sandi Token khusus jika Anda memiliki izin untuk mengakses menu Upload.</p>
                    <div style="margin-top: 1rem;">
                        <input type="password" id="token-input" placeholder="Masukkan Token"
                            style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; font-family: inherit; background: var(--bg-color); color: var(--text-primary); box-sizing: border-box;">
                        <div id="token-status"
                            style="margin-top: 0.5rem; text-align: left; font-size: 0.85rem; min-height: 1.2em;"></div>
                    </div>
                </div>

                <button id="save-cookie-prefs-btn" class="btn-upload" style="margin-top: 2rem;">Simpan Perubahan &
                    Tutup</button>
            </div>
        </div>
    </div>

    <!-- Cookie Consent Banner -->
    <div id="cookie-consent-banner" class="cookie-consent-banner">
        <p>Situs ini menggunakan penyimpanan lokal untuk fungsionalitas seperti tema & bookmark. Dengan melanjutkan,
            Anda setuju dengan penggunaan ini.</p>
        <div class="cookie-consent-actions">
            <button id="manage-cookies-btn" class="btn-secondary">Kelola Pilihan</button>
            <button id="accept-cookie-btn">Mengerti & Setuju</button>
        </div>
    </div>

    <!-- Modal Upload -->
    <div id="upload-modal" class="modal fullscreen-modal">
        <div class="modal-content fullscreen">
            <div class="modal-body" style="padding: 0; flex-grow: 1; position: relative;">
                <iframe id="upload-iframe" style="width: 100%; height: 100%; border: none;" src="about:blank"></iframe>
            </div>
        </div>
    </div>



    <script src="script.js"></script>
</body>

</html>