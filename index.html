<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F.AGRIELLA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icon Library (Phosphor Icons) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- OneSignal SDK -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "8d435ddc-5a2b-4a91-83c4-3c10d0ed5fc6",
        });
      });
    </script>
    <link rel="stylesheet" href="style.css">
    <script>
        // Mencegah "flash" dengan menerapkan preferensi dari localStorage sebelum render
        (function() {
            // Hanya terapkan jika persetujuan untuk personalisasi telah diberikan
            if (localStorage.getItem('consent_personalization') === 'true') {
                if (localStorage.getItem('theme') === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }
            }
        })();
    </script>
</head>
<body>

    <!-- Main Menu (Sliding from left) -->
    <div id="main-menu" class="main-menu">
        <div class="main-menu-header">
            <a href="#" class="logo">
                <span class="accent">F.</span>AGRIELLA
            </a>
            <button id="close-main-menu" class="icon-btn" style="font-size: 2rem; color: var(--white);">&times;</button>
        </div>
        <ul class="main-menu-links">
            <li><a href="#" id="menu-beranda"><i class="ph ph-house"></i> Beranda</a></li>
            <li><a href="#" id="menu-arsip-foto"><i class="ph ph-images"></i> Arsip Foto</a></li>
            <li><a href="#" id="menu-pengaturan"><i class="ph ph-gear"></i> Pengaturan</a></li>
        </ul>
    </div>
    <div id="menu-overlay" class="menu-overlay"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Memuat data...</p>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container nav-container">
            <div class="nav-left">
                <button id="menu-toggle" class="icon-btn" aria-label="Menu">
                    <i class="ph ph-list"></i>
                </button>
                <a href="#" class="logo">
                    <span class="accent">F.</span>AGRIELLA
                </a>
            </div>
            <div class="nav-controls">
                <div class="search-bar">
                    <i class="ph ph-magnifying-glass"></i>
                    <input type="text" id="global-search" placeholder="Cari materi, dosen, atau tugas...">
                </div>
                <button id="notif-toggle" class="icon-btn" aria-label="Notifikasi">
                    <i class="ph ph-bell"></i>
                </button>
                <button id="theme-toggle" class="icon-btn" aria-label="Toggle Dark Mode">
                    <i class="ph ph-moon"></i>
                </button>
            </div>
        </div>
    </nav>


    <main class="container main-layout">
        
        <!-- Sidebar / Dashboard Ringkas -->
        <aside class="sidebar">
            <div class="dashboard-card">
                <h3>Dashboard</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-val" id="total-courses">0</span>
                        <span class="stat-label">Mata Kuliah</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-val" id="total-assignments">0</span>
                        <span class="stat-label">Tugas Aktif</span>
                    </div>
                </div>
            </div>

            <div class="assignment-section">
                <div class="section-title">
                    <h3><i class="ph ph-calendar"></i> Tugas Terbaru</h3>
                </div>
                <!-- List Tugas (Di-inject oleh JS berdasarkan nama file tanggal) -->
                <div id="assignment-list" class="assignment-list">
                    <div class="skeleton-loader"></div>
                </div>
            </div>

            <div class="quick-links">
                <h3>Bookmark</h3>
                <ul id="bookmark-list" style="list-style: none; padding-left: 0;">
                    <li class="empty-state">Belum ada bookmark</li>
                </ul>
            </div>
        </aside>

        <!-- Main Content: Daftar Mata Kuliah -->
        <section class="content-area">
            <div class="content-header">
                <h2>Daftar Mata Kuliah</h2>
                <div class="filters">
                    <select id="semester-filter">
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                        <option value="3">Semester 3</option>
                    </select>
                </div>
            </div>

            <!-- Grid Mata Kuliah (Sumber: Google Sheets Logic) -->
            <div id="course-grid" class="course-grid">
                <!-- Course Cards injected here -->
            </div>
        </section>

    </main>

    <!-- Modal Detail Materi -->
    <div id="material-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Detail Mata Kuliah</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modal-meta-container"></div>
                <div class="modal-tabs">
                    <button class="tab-btn active" data-tab="dokumen">Dokumen</button>
                    <button class="tab-btn" data-tab="foto">Foto</button>
                </div>
                <div class="file-list" id="modal-files">
                    <!-- File items injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detail Tugas (JSON Viewer) -->
    <div id="assignment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Detail Tugas Harian</h2>
                <button class="close-modal" id="close-assign-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1.5rem; color: var(--text-secondary); border-bottom:1px solid var(--border-color); padding-bottom:1rem;">
                    <i class="ph ph-calendar-check"></i> Tanggal Dibuat: <span id="assign-modal-date" style="font-weight:600; color:var(--text-primary);"></span>
                </div>
                <div id="assign-modal-list">
                    <!-- List Tugas Injected Here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Preview File -->
    <div id="preview-modal" class="modal" style="z-index: 1100;">
        <div class="modal-content" style="height: 90vh; max-width: 90vw;">
            <div class="modal-header">
                <h2 id="preview-title" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80%;">Preview</h2>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button id="fullscreen-btn" class="close-modal" style="font-size: 1.5rem;" title="Fullscreen"><i class="ph ph-corners-out"></i></button>
                    <button class="close-modal" id="close-preview-modal">&times;</button>
                </div>
            </div>
            <div class="modal-body" style="padding: 0; height: 100%; display: flex; flex-direction: column; overflow: hidden;">
                <iframe id="preview-frame" style="width: 100%; height: 100%; border: none;" src="" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <!-- Modal Pengaturan Cookie -->
    <div id="cookie-settings-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Pusat Privasi</h2>
                <button class="close-modal" id="close-cookie-settings-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Anda dapat mengontrol penyimpanan data di browser Anda. Pilihan Anda akan disimpan untuk kunjungan berikutnya.</p>
                <div class="cookie-pref-item">
                    <h4>Penyimpanan Fungsional</h4>
                    <p>Selalu aktif. Diperlukan agar situs dapat berfungsi dengan benar.</p>
                </div>
                <div class="cookie-pref-item">
                    <h4>Preferensi & Personalisasi</h4>
                    <p>Izinkan situs menyimpan preferensi tampilan (seperti Tema Gelap) dan item yang Anda tandai (Bookmark).</p>
                    <label class="toggle-switch">
                        <input type="checkbox" id="consent-personalization-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <button id="save-cookie-prefs-btn" class="btn-upload" style="margin-top: 2rem;">Simpan Pilihan & Tutup</button>
            </div>
        </div>
    </div>

    <!-- Cookie Consent Banner -->
    <div id="cookie-consent-banner" class="cookie-consent-banner">
        <p>Situs ini menggunakan penyimpanan lokal untuk fungsionalitas seperti tema & bookmark. Dengan melanjutkan, Anda setuju dengan penggunaan ini.</p>
        <div class="cookie-consent-actions">
            <button id="manage-cookies-btn" class="btn-secondary">Kelola Pilihan</button>
            <button id="accept-cookie-btn">Mengerti & Setuju</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
